(()=>{"use strict";var e={529:(e,t)=>{t.qQ=t.Bg=t.yD=t.YH=t.Zf=t.E$=t.H_=t.wz=t.E5=t.Cj=void 0,t.Cj="w",t.E5="b",t.wz="p",t.H_="n",t.E$="b",t.Zf="r",t.YH="q",t.yD="k",t.Bg="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";const s=-1,o={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},i={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},r={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},n={b:[16,32,17,15],w:[-16,-32,-17,-15]},a={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},l=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],c=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],h={p:1,n:2,b:4,r:8,q:16,k:32},u=[t.H_,t.E$,t.Zf,t.YH],d={w:[{square:r.a1,flag:i.QSIDE_CASTLE},{square:r.h1,flag:i.KSIDE_CASTLE}],b:[{square:r.a8,flag:i.QSIDE_CASTLE},{square:r.h8,flag:i.KSIDE_CASTLE}]},m={b:1,w:6},f=["1-0","0-1","1/2-1/2","*"];function _(e){return e>>4}function p(e){return 15&e}function g(e){return-1!=="0123456789".indexOf(e)}function v(e){const t=p(e),s=_(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(s,s+1)}function b(e){return e===t.Cj?t.E5:t.Cj}function y(e,s,o,r,n,a,l=i.NORMAL){const c=_(r);if(n!==t.wz||7!==c&&0!==c)e.push({color:s,from:o,to:r,piece:n,captured:a,promotion:void 0,flags:l});else for(let t=0;t<u.length;t++){const c=u[t];e.push({color:s,from:o,to:r,piece:n,captured:a,promotion:c,flags:l|i.PROMOTION})}}function L(e){let s=e.charAt(0);if(s>="a"&&s<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return t.wz}return s=s.toLowerCase(),"o"===s?t.yD:s}function E(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}t.qQ=class{constructor(e=t.Bg){this._board=new Array(128),this._turn=t.Cj,this._header={},this._kings={w:s,b:s},this._epSquare=-1,this._halfMoves=0,this._moveNumber=0,this._history=[],this._comments={},this._castling={w:0,b:0},this.load(e)}clear(e=!1){this._board=new Array(128),this._kings={w:s,b:s},this._turn=t.Cj,this._castling={w:0,b:0},this._epSquare=s,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._updateSetup(this.fen())}load(e,o=!1){const n=e.split(/\s+/),a=n[0];let l=0;if(!function(e){const t=[];t[0]="No errors.",t[1]="FEN string must contain six space-delimited fields.",t[2]="6th field (move number) must be a positive integer.",t[3]="5th field (half move counter) must be a non-negative integer.",t[4]="4th field (en-passant square) is invalid.",t[5]="3rd field (castling availability) is invalid.",t[6]="2nd field (side to move) is invalid.",t[7]="1st field (piece positions) does not contain 8 '/'-delimited rows.",t[8]="1st field (piece positions) is invalid [consecutive numbers].",t[9]="1st field (piece positions) is invalid [invalid piece].",t[10]="1st field (piece positions) is invalid [row too large].",t[11]="Illegal en-passant square";const s=e.split(/\s+/);if(6!==s.length)return{valid:!1,errorNumber:1,error:t[1]};const o=parseInt(s[5],10);if(isNaN(o)||o<=0)return{valid:!1,errorNumber:2,error:t[2]};const i=parseInt(s[4],10);if(isNaN(i)||i<0)return{valid:!1,errorNumber:3,error:t[3]};if(!/^(-|[abcdefgh][36])$/.test(s[3]))return{valid:!1,errorNumber:4,error:t[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(s[2]))return{valid:!1,errorNumber:5,error:t[5]};if(!/^(w|b)$/.test(s[1]))return{valid:!1,errorNumber:6,error:t[6]};const r=s[0].split("/");if(8!==r.length)return{valid:!1,errorNumber:7,error:t[7]};for(let e=0;e<r.length;e++){let s=0,o=!1;for(let i=0;i<r[e].length;i++)if(g(r[e][i])){if(o)return{valid:!1,errorNumber:8,error:t[8]};s+=parseInt(r[e][i],10),o=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[e][i]))return{valid:!1,errorNumber:9,error:t[9]};s+=1,o=!1}if(8!==s)return{valid:!1,errorNumber:10,error:t[10]}}return"3"==s[3][1]&&"w"==s[1]||"6"==s[3][1]&&"b"==s[1]?{valid:!1,errorNumber:11,error:t[11]}:{valid:!0,errorNumber:0,error:t[0]}}(e).valid)return!1;this.clear(o);for(let e=0;e<a.length;e++){const s=a.charAt(e);if("/"===s)l+=8;else if(g(s))l+=parseInt(s,10);else{const e=s<"a"?t.Cj:t.E5;this.put({type:s.toLowerCase(),color:e},v(l)),l++}}return this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=i.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=i.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=i.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=i.QSIDE_CASTLE),this._epSquare="-"===n[3]?s:r[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._updateSetup(this.fen()),!0}fen(){let e=0,o="";for(let s=r.a8;s<=r.h1;s++){if(this._board[s]){e>0&&(o+=e,e=0);const{color:i,type:r}=this._board[s];o+=i===t.Cj?r.toUpperCase():r.toLowerCase()}else e++;s+1&136&&(e>0&&(o+=e),s!==r.h1&&(o+="/"),e=0,s+=8)}let n="";this._castling[t.Cj]&i.KSIDE_CASTLE&&(n+="K"),this._castling[t.Cj]&i.QSIDE_CASTLE&&(n+="Q"),this._castling[t.E5]&i.KSIDE_CASTLE&&(n+="k"),this._castling[t.E5]&i.QSIDE_CASTLE&&(n+="q"),n=n||"-";const a=this._epSquare===s?"-":v(this._epSquare);return[o,this._turn,n,a,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==t.Bg?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(t.Bg)}get(e){return this._board[r[e]]||!1}put({type:e,color:o},i){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase()))return!1;if(!(i in r))return!1;const n=r[i];return(e!=t.yD||this._kings[o]==s||this._kings[o]==n)&&(this._board[n]={type:e,color:o},e===t.yD&&(this._kings[o]=n),this._updateSetup(this.fen()),!0)}remove(e){const o=this.get(e);return delete this._board[r[e]],o&&o.type===t.yD&&(this._kings[o.color]=s),this._updateSetup(this.fen()),o}_attacked(e,s){for(let o=r.a8;o<=r.h1;o++){if(136&o){o+=7;continue}if(void 0===this._board[o]||this._board[o].color!==e)continue;const i=this._board[o],r=o-s,n=r+119;if(l[n]&h[i.type]){if(i.type===t.wz){if(r>0){if(i.color===t.Cj)return!0}else if(i.color===t.E5)return!0;continue}if("n"===i.type||"k"===i.type)return!0;const e=c[n];let a=o+e,l=!1;for(;a!==s;){if(null!=this._board[a]){l=!0;break}a+=e}if(!l)return!0}}return!1}_isKingAttacked(e){return this._attacked(b(e),this._kings[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},s=[];let o=0,i=0;for(let n=r.a8;n<=r.h1;n++){if(i=(i+1)%2,136&n){n+=7;continue}const r=this._board[n];r&&(e[r.type]=r.type in e?e[r.type]+1:1,r.type===t.E$&&s.push(i),o++)}if(2===o)return!0;if(3===o&&(1===e[t.E$]||1===e[t.H_]))return!0;if(o===e[t.E$]+2){let e=0;const t=s.length;for(let o=0;o<t;o++)e+=s[o];if(0===e||e===t)return!0}return!1}isThreefoldRepetition(){const e=[],t={};let s=!1;for(;;){const t=this._undoMove();if(!t)break;e.push(t)}for(;;){const o=this.fen().split(" ").slice(0,4).join(" ");t[o]=o in t?t[o]+1:1,t[o]>=3&&(s=!0);const i=e.pop();if(!i)break;this._makeMove(i)}return s}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t}={}){const s=this._moves({square:t});return e?s.map((e=>this._makePretty(e))):s.map((e=>this._moveToSan(e,s)))}_moves({legal:e=!0,piece:s,square:o}={}){var l;const c=o?o.toLowerCase():void 0,h=null==s?void 0:s.toLowerCase(),u=[],d=this._turn,f=b(d);let p=r.a8,g=r.h1,v=!1;if(c){if(!(c in r))return[];p=g=r[c],v=!0}for(let e=p;e<=g;e++){if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===f)continue;const{type:s}=this._board[e];let o;if(s===t.wz){if(h&&h!==s)continue;o=e+n[d][0],this._board[o]||(y(u,d,e,o,t.wz),o=e+n[d][1],m[d]!==_(e)||this._board[o]||y(u,d,e,o,t.wz,void 0,i.BIG_PAWN));for(let s=2;s<4;s++)o=e+n[d][s],136&o||((null===(l=this._board[o])||void 0===l?void 0:l.color)===f?y(u,d,e,o,t.wz,this._board[o].type,i.CAPTURE):o===this._epSquare&&y(u,d,e,o,t.wz,t.wz,i.EP_CAPTURE))}else{if(h&&h!==s)continue;for(let r=0,n=a[s].length;r<n;r++){const n=a[s][r];for(o=e;o+=n,!(136&o);){if(this._board[o]){if(this._board[o].color===d)break;y(u,d,e,o,s,this._board[o].type,i.CAPTURE);break}if(y(u,d,e,o,s),s===t.H_||s===t.yD)break}}}}if(!(void 0!==h&&h!==t.yD||v&&g!==this._kings[d])){if(this._castling[d]&i.KSIDE_CASTLE){const e=this._kings[d],s=e+2;this._board[e+1]||this._board[s]||this._attacked(f,this._kings[d])||this._attacked(f,e+1)||this._attacked(f,s)||y(u,d,this._kings[d],s,t.yD,void 0,i.KSIDE_CASTLE)}if(this._castling[d]&i.QSIDE_CASTLE){const e=this._kings[d],s=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(f,this._kings[d])||this._attacked(f,e-1)||this._attacked(f,s)||y(u,d,this._kings[d],s,t.yD,void 0,i.QSIDE_CASTLE)}}if(!e)return u;const L=[];for(let e=0,t=u.length;e<t;e++)this._makeMove(u[e]),this._isKingAttacked(d)||L.push(u[e]),this._undoMove();return L}move(e,{sloppy:t=!1}={}){let s=null;if("string"==typeof e)s=this._moveFromSan(e,t);else if("object"==typeof e){const t=this._moves();for(let o=0,i=t.length;o<i;o++)if(e.from===v(t[o].from)&&e.to===v(t[o].to)&&(!("promotion"in t[o])||e.promotion===t[o].promotion)){s=t[o];break}}if(!s)return null;const o=this._makePretty(s);return this._makeMove(s),o}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const o=this._turn,r=b(o);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&i.EP_CAPTURE&&(this._turn===t.E5?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:o}),this._board[e.to].type===t.yD){if(this._kings[o]=e.to,e.flags&i.KSIDE_CASTLE){const t=e.to-1,s=e.to+1;this._board[t]=this._board[s],delete this._board[s]}else if(e.flags&i.QSIDE_CASTLE){const t=e.to+1,s=e.to-2;this._board[t]=this._board[s],delete this._board[s]}this._castling[o]=0}if(this._castling[o])for(let t=0,s=d[o].length;t<s;t++)if(e.from===d[o][t].square&&this._castling[o]&d[o][t].flag){this._castling[o]^=d[o][t].flag;break}if(this._castling[r])for(let t=0,s=d[r].length;t<s;t++)if(e.to===d[r][t].square&&this._castling[r]&d[r][t].flag){this._castling[r]^=d[r][t].flag;break}e.flags&i.BIG_PAWN?o===t.E5?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=s,e.piece===t.wz||e.flags&(i.CAPTURE|i.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,o===t.E5&&this._moveNumber++,this._turn=r}undo(){const e=this._undoMove();return e?this._makePretty(e):null}_undoMove(){const e=this._history.pop();if(void 0===e)return null;const s=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const o=this._turn,r=b(o);if(this._board[s.from]=this._board[s.to],this._board[s.from].type=s.piece,delete this._board[s.to],s.captured)if(s.flags&i.EP_CAPTURE){let e;e=o===t.E5?s.to-16:s.to+16,this._board[e]={type:t.wz,color:r}}else this._board[s.to]={type:s.captured,color:r};if(s.flags&(i.KSIDE_CASTLE|i.QSIDE_CASTLE)){let e,t;s.flags&i.KSIDE_CASTLE?(e=s.to+1,t=s.to-1):(e=s.to-2,t=s.to+1),this._board[e]=this._board[t],delete this._board[t]}return s}pgn({newline:e="\n",maxWidth:t=0}={}){const s=[];let o=!1;for(const t in this._header)s.push("["+t+' "'+this._header[t]+'"]'+e),o=!0;o&&this._history.length&&s.push(e);const i=e=>{const t=this._comments[this.fen()];return void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`),e},r=[];for(;this._history.length>0;)r.push(this._undoMove());const n=[];let a="";for(0===r.length&&n.push(i(""));r.length>0;){a=i(a);const e=r.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(a.length&&n.push(a),a=this._moveNumber+".");else{const e=`${this._moveNumber}. ...`;a=a?`${a} ${e}`:e}a=a+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(a.length&&n.push(i(a)),void 0!==this._header.Result&&n.push(this._header.Result),0===t)return s.join("")+n.join(" ");const l=function(){return s.length>0&&" "===s[s.length-1]&&(s.pop(),!0)},c=function(o,i){for(const r of i.split(" "))if(r){if(o+r.length>t){for(;l();)o--;s.push(e),o=0}s.push(r),o+=r.length,s.push(" "),o++}return l()&&o--,o};let h=0;for(let o=0;o<n.length;o++)h+n[o].length>t&&n[o].includes("{")?h=c(h,n[o]):(h+n[o].length>t&&0!==o?(" "===s[s.length-1]&&s.pop(),s.push(e),h=0):0!==o&&(s.push(" "),h++),s.push(n[o]),h+=n[o].length);return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}loadPgn(e,{sloppy:t=!1,newlineChar:s="\r?\n"}={}){function o(e){return e.replace(/\\/g,"\\")}e=e.trim();const i=new RegExp("^(\\[((?:"+o(s)+")|.)*\\])(?:\\s*"+o(s)+"){2}").exec(e),r=i&&i.length>=2?i[1]:"";this.reset();const n=function(e){const t={},i=e.split(new RegExp(o(s)));let r="",n="";for(let e=0;e<i.length;e++){const s=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;r=i[e].replace(s,"$1"),n=i[e].replace(s,"$2"),r.trim().length>0&&(t[r]=n)}return t}(r);let a="";for(const e in n)"fen"===e.toLowerCase()&&(a=n[e]),this.header(e,n[e]);if(t){if(a&&!this.load(a,!0))return!1}else if(!("1"!==n.SetUp||"FEN"in n&&this.load(n.FEN,!0)))return!1;const l=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(o(s),"g")," ")).slice(1,e.length-1))}}`},c=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+(e.match(/.{1,2}/g)||[]).join("%"))}(e.slice(1,e.length-1))};let h=e.replace(r,"").replace(new RegExp(`({[^}]*})+?|;([^${o(s)}]*)`,"g"),(function(e,t,s){return void 0!==t?l(t):" "+l(`{${s.slice(1)}}`)})).replace(new RegExp(o(s),"g")," ");const u=/(\([^()]+\))+?/g;for(;u.test(h);)h=h.replace(u,"");h=h.replace(/\d+\.(\.\.)?/g,""),h=h.replace(/\.\.\./g,""),h=h.replace(/\$\d+/g,"");let d=h.trim().split(new RegExp(/\s+/));d=d.join(",").replace(/,,+/g,",").split(",");let m="";for(let e=0;e<d.length;e++){const s=c(d[e]);if(void 0!==s){this._comments[this.fen()]=s;continue}const o=this._moveFromSan(d[e],t);if(null==o){if(!(f.indexOf(d[e])>-1))return!1;m=d[e]}else m="",this._makeMove(o)}return m&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",m),!0}_moveToSan(e,s){let o="";if(e.flags&i.KSIDE_CASTLE)o="O-O";else if(e.flags&i.QSIDE_CASTLE)o="O-O-O";else{if(e.piece!==t.wz){const t=function(e,t){const s=e.from,o=e.to,i=e.piece;let r=0,n=0,a=0;for(let e=0,l=t.length;e<l;e++){const l=t[e].from,c=t[e].to;i===t[e].piece&&s!==l&&o===c&&(r++,_(s)===_(l)&&n++,p(s)===p(l)&&a++)}return r>0?n>0&&a>0?v(s):a>0?v(s).charAt(1):v(s).charAt(0):""}(e,s);o+=e.piece.toUpperCase()+t}e.flags&(i.CAPTURE|i.EP_CAPTURE)&&(e.piece===t.wz&&(o+=v(e.from)[0]),o+="x"),o+=v(e.to),e.promotion&&(o+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?o+="#":o+="+"),this._undoMove(),o}_moveFromSan(e,t=!1){const s=E(e);let o,i,n,a,l,c=L(s),h=this._moves({legal:!0,piece:c});for(let e=0,t=h.length;e<t;e++)if(s===E(this._moveToSan(h[e],h)))return h[e];if(!t)return null;let u=!1;i=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),i?(o=i[1],n=i[2],a=i[3],l=i[4],1==n.length&&(u=!0)):(i=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),i&&(o=i[1],n=i[2],a=i[3],l=i[4],1==n.length&&(u=!0))),c=L(s),h=this._moves({legal:!0,piece:o||c});for(let e=0,t=h.length;e<t;e++)if(n&&a){if(!(o&&o.toLowerCase()!=h[e].piece||r[n]!=h[e].from||r[a]!=h[e].to||l&&l.toLowerCase()!=h[e].promotion))return h[e];if(u){const t=v(h[e].from);if(!(o&&o.toLowerCase()!=h[e].piece||r[a]!=h[e].to||n!=t[0]&&n!=t[1]||l&&l.toLowerCase()!=h[e].promotion))return h[e]}}return null}ascii(){let e="   +------------------------+\n";for(let s=r.a8;s<=r.h1;s++){if(0===p(s)&&(e+=" "+"87654321"[_(s)]+" |"),this._board[s]){const o=this._board[s].type;e+=" "+(this._board[s].color===t.Cj?o.toUpperCase():o.toLowerCase())+" "}else e+=" . ";s+1&136&&(e+="|\n",s+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const o=this._turn;for(let i=0,r=t.length;i<r;i++)this._makeMove(t[i]),this._isKingAttacked(o)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}_makePretty(e){const{color:t,piece:s,from:r,to:n,flags:a,captured:l,promotion:c}=e;let h="";for(const e in i)i[e]&a&&(h+=o[e]);const u={color:t,piece:s,from:v(r),to:v(n),san:this._moveToSan(e,this._moves({legal:!0})),flags:h};return l&&(u.captured=l),c&&(u.promotion=c),u}turn(){return this._turn}board(){const e=[];let t=[];for(let s=r.a8;s<=r.h1;s++)null==this._board[s]?t.push(null):t.push({square:v(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in r){const t=r[e];return(_(t)+p(t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const o=t.pop();if(!o)break;e?s.push(this._makePretty(o)):s.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return s}_pruneComments(){const e=[],t={},s=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const t=e.pop();if(!t)break;this._makeMove(t),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map((e=>({fen:e,comment:this._comments[e]})))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map((e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}}))}}}},t={};function s(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,s),r.exports}(()=>{var e=s(529);function t(e,t){let s,o="Победа белых",i="Победа черных",r="Ничья, недостаток фигур",n="Ничья, патовая ситуация";console.log(t),t.isStalemate()?(s=n,document.title=n):t.isDraw()?(s=r,document.title=r):t.isCheckmate()?"w"==t.turn()?(s=i,document.title=i):(s=o,document.title=o):e&&("w"==e?(s=i,document.title=i):(s=o,document.title=o)),function(e){let t=document.createElement("div");t.classList.add("chess__GameOver"),t.innerHTML=`<h1>${e}</h1>`,document.querySelector("#chess").appendChild(t)}(s)}let o,i,r="my",n={1:document.querySelector("#time-my"),2:document.querySelector("#time-my2")},a={1:document.querySelector("#time-opponent"),2:document.querySelector("#time-opponent2")},l={my:600,opponent:600};function c(e){let t="00",s="00";return e>=60&&(t=Math.floor(e/60)),e>0&&(s=e%60),t<10&&"00"!==t&&(t="0"+t),s<10&&"00"!==s&&(s="0"+s),`${t}:${s}`}function h(){Object.values(n).map((e=>{e.innerHTML=c(l.my)})),Object.values(a).map((e=>{e.innerHTML=c(l.opponent)}))}let u,d,m=!0,f=!0;function _(e,s,n){document.title="Ваш ход!",v(),o||(o=Date.now());let a=0;i=setInterval((()=>{let c=Date.now()-o,u=Math.floor(c/1e3);0==l.my&&(m=!1,s=!0,t(n,e)),"my"!==r&&(l.my-=u-a,h(),a+=1,clearInterval(i)),(e.isGameOver()||s)&&clearInterval(i),m?u>a&&(l.my-=u-a,h(),a+=1):clearInterval(i)}),100)}function p(e,s,o){document.title="Ход противника!",v(),u||(u=Date.now());let i=0;d=setInterval((()=>{let n=Date.now()-u,a=Math.floor(n/1e3);0==l.opponent&&(f=!1,s=!0,t(o,e)),"opponent"!==r&&(l.opponent-=a-i,h(),i+=1,clearInterval(d)),(e.isGameOver()||s)&&clearInterval(d),f?a>i&&(l.opponent-=a-i,h(),i+=1):clearInterval(d)}),100)}function g({game:e,gameover:t,setTurn:s}){s?r=s:"my"==r?(r="opponent",u+=Date.now()-u,p(e,t)):"opponent"==r&&(r="my",o+=Date.now()-o,_(e,t))}function v(){"opponent"==r?(Object.values(a).map(((e,t)=>{1==t?(e.closest(".timer").classList.remove(`off${t+1}`),e.closest(".timer").classList.add(`on${t+1}`)):(e.closest(".timer").classList.remove("off"),e.closest(".timer").classList.add("on"))})),Object.values(n).map(((e,t)=>{1==t?(e.closest(".timer").classList.remove(`on${t+1}`),e.closest(".timer").classList.add(`off${t+1}`)):(e.closest(".timer").classList.remove("on"),e.closest(".timer").classList.add("off"))}))):"my"==r&&(Object.values(n).map(((e,t)=>{1==t?(e.closest(".timer").classList.remove(`off${t+1}`),e.closest(".timer").classList.add(`on${t+1}`)):(e.closest(".timer").classList.remove("off"),e.closest(".timer").classList.add("on"))})),Object.values(a).map(((e,t)=>{1==t?(e.closest(".timer").classList.remove(`on${t+1}`),e.closest(".timer").classList.add(`off${t+1}`)):(e.closest(".timer").classList.remove("on"),e.closest(".timer").classList.add("off"))})))}let b=document.querySelector(".players-chess__side.opponent"),y=document.querySelector(".players-chess__side.my");function L(e){y.classList.remove("white"),y.classList.remove("black"),b.classList.remove("white"),b.classList.remove("black"),"w"==e?(y.classList.add("white"),b.classList.add("black")):(y.classList.add("black"),b.classList.add("white"))}let E=document.querySelector(".moves-side__moves"),S=document.querySelector(".moves-headline__box");function w(){E.innerHTML="",S.innerHTML=""}function k(){Array.from(document.querySelectorAll(".square-55d63")).forEach((e=>{e.classList.remove("highlight-legal"),e.classList.remove("highlight-eat"),e.classList.remove("move")}))}document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".burger-header"),t=document.querySelector("body"),s=document.querySelector("header"),o=document.querySelector(".header__backdrop");function i(){e.classList.remove("active"),t.classList.remove("hide"),s.classList.remove("on")}e.addEventListener("click",(function(o){o.target.classList.contains("menu-burger__list")||o.target.classList.contains("search-header__input")||(o.target.parentNode.classList.contains("menu-burger__item")?i():(e.classList.toggle("active"),t.classList.toggle("hide"),s.classList.toggle("on")))})),o.addEventListener("click",(()=>{i()}))}),!1),document.addEventListener("DOMContentLoaded",(function(){let e=Array.from(document.querySelectorAll(".a")),t=e.length;window.addEventListener("load",(()=>{function s(e){e.classList.contains("part")?function(e){(function(e){let t=e.getBoundingClientRect(),s=t.top,o=t.bottom,i=t.height;return s+i>=0&&i+window.innerHeight>=o})(e)&&(e.classList.add("v"),e.classList.remove("part"),e.classList.remove("a"),t--)}(e):e.classList.contains("full")&&function(e){(function(e){let t=e.getBoundingClientRect(),s=t.top,o=t.bottom;return s>=0&&o<=window.innerHeight})(e)&&(e.classList.add("v"),e.classList.remove("full"),e.classList.remove("a"),t--)}(e)}e.map((e=>s(e))),window.addEventListener("scroll",(()=>{t>0&&e.forEach((e=>{s(e)}))}))}))}),!1),document.addEventListener("DOMContentLoaded",(function(){!function(){let e,t;[...document.querySelectorAll(".players-chess__flag"),...document.querySelectorAll(".playersMobile__flag")].map((s=>{s.addEventListener("click",(()=>{e&&t?(t===s&&clearTimeout(e),s.classList.add("show"),e=setTimeout((()=>{s.classList.remove("show")}),2e3)):(t=s,s.classList.add("show"),e=setTimeout((()=>{s.classList.remove("show")}),2e3))}))}))}(),function(){function e(e){e=window.event||e;var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));document.getElementById("moves").scrollLeft-=40*t,e.preventDefault()}document.getElementById("moves").addEventListener?(document.getElementById("moves").addEventListener("mousewheel",e,!1),document.getElementById("moves").addEventListener("DOMMouseScroll",e,!1)):document.getElementById("moves").attachEvent("onmousewheel",e)}(),function(){let e=document.querySelector(".right-side"),t=document.querySelector("#chat-enable");function s(){t.checked?e.classList.add("chat-off"):e.classList.remove("chat-off")}s(),t.addEventListener("click",s);let o=document.querySelector(".chat-chess"),i=document.querySelector(".chat-openbtn"),r=document.querySelector(".chat-chess__close"),n=document.querySelector(".chess__chatbackdrop");function a(){n.classList.remove("show"),o.classList.remove("show")}i.addEventListener("click",(()=>{o.classList.add("show"),n.classList.add("show")})),[r,n].map((e=>e.addEventListener("click",a)))}();let s,r=document.querySelector("#board"),n=new e.qQ,a=[];function c(){a.length&&a.forEach((e=>{document.querySelector(`.square-${e.to}`).onclick=null}))}function b(e,t){let s=n.move({from:e,to:t});if(console.log(s),null===s){if(!function(e,t){let s=n.moves({verbose:!0}).find((s=>{let o=Object.values(s);return o.includes(e)&&o.includes(t)}));return!!s}(e,t)||e===t)return"snapback";let o={from:e,to:t},i=prompt("Фигура. Королева: q | Ладья: r | Слон: b | Конь: n","q");o.promotion=i||"q",s=n.move(o)}q(),k(),A(s)}function y(){g({game:n,gameover:N}),O.position(n.fen()),n.isGameOver()?t("my",n):(P(),C(),c())}function C(){let e=n.moves({verbose:!0});if(0===e.length)return;let o=e[Math.floor(Math.random()*e.length)];s=setTimeout((()=>{!function(e){n.isGameOver()||N||(n.move(e.san),q(),A(e),O.position(n.fen()),n.fen(),n.isGameOver()?t("opponent",n):(P(),g({game:n,gameover:N})))}(o)}),1200)}function q(){Array.from(r.querySelectorAll(".square-55d63")).map((e=>{e.classList.remove("highlight-from"),e.classList.remove("highlight-to")}))}function A(e){r.querySelector(`.square-${e.from}`).classList.add("highlight-from"),r.querySelector(`.square-${e.to}`).classList.add("highlight-to")}let T,I,M,D="b",N=!1;function $(e){"w"==e?(I="w",M="b",T=/^b/,g({setTurn:"my"}),L(I),_(n,N,I)):"b"==e&&(I="b",M="w",T=/^w/,g({setTurn:"opponent"}),L(I),p(n,N,M),C()),v()}$(D);let O=Chessboard("board",{draggable:!0,orientation:"w"==I?"white":"black",position:"start",onDragStart:function(e,t,s,o){if(n.isGameOver()||N)return!1;if(-1!==t.search(T))return!1;let i=n.moves({verbose:!0,square:e});var r;r=i,k(),r[0]&&(document.querySelector(`.square-${r[0].from}`).classList.add("highlight-legal"),r.forEach((e=>{let t=document.querySelector(`.square-${e.to}`);t.classList.contains("highlight-to")||(function(e){return Array.from(e.childNodes).find((e=>e.classList.contains("piece-417db")))}(t)?t.classList.add("highlight-eat"):t.classList.add("move"))}))),function(e){c(),a=e,e.forEach((e=>{document.querySelector(`.square-${e.to}`).onclick=()=>{b(e.from,e.to),y()}}))}(i)},onDrop:b,onSnapEnd:y});function P(){!function(e){let t=e.split(/\d+\./);t=t.filter((e=>""!==e.trim())).map(((e,t)=>`${t+1}. `+e.trim())),w(),t.forEach((e=>{let[t,s]=e.split(".");!function(e,t){let s=document.createElement("div");s.classList.add("moves-side__row"),s.innerHTML=`\n\t  <div class="moves-side__count">${e}.</div>\n\t  <div class="moves-side__move">${t}</div>\n\t  `,E.appendChild(s)}(t,s),function(e,t){let s=document.createElement("div");s.classList.add("moves-headline__move"),s.innerHTML=`\n\t  <span class="moves-headline__count">${e}.</span>\n      <span>${t}</span>\n\t  `,S.appendChild(s)}(t,s)}))}(n.pgn())}!function(e){let t=document.querySelector(".board-chess__wrapper"),s=document.querySelector("#board");function o(){let o=document.querySelector(".playersMobile"),i=t.offsetWidth,r=t.offsetHeight,n=30;window.innerWidth<=479.98&&(n=20),i>r?(s.style.width=r-n+"px",e.resize(r-n,r-n),o.style.width=`${r}px`,o.style.height=`${r}px`):(s.style.width=i-n+"px",e.resize(i-n,i-n),o.style.width=`${i}px`,o.style.height=`${i}px`)}o(),window.addEventListener("resize",o)}(O);let R=document.querySelector("#play-white"),j=document.querySelector("#play-black");function x(t){s&&clearTimeout(s),D=t,T="w"==D?/^w/:/^b/,n=new e.qQ,clearInterval(i),clearInterval(d),o=Date.now(),u=Date.now(),m=!0,f=!0,l={my:600,opponent:600},h(),L(D),$(D),O.start(!1),O.orientation("w"==D?"white":"black"),w()}R.addEventListener("click",(()=>x("w"))),j.addEventListener("click",(()=>x("b")))}))})()})();